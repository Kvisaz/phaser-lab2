(()=>{(()=>{"use strict";class u extends Phaser.Scene{preload(){}create(){console.log("Story Scene created...")}}const g=s=>({title:s,template:"titleDelimiter"});class p extends Phaser.GameObjects.Container{constructor({scene:e,text:t}){super(e);const i=e.add.text(0,0,t,{fontSize:"32px",color:"#dedede"});this.add([i]),e.add.existing(this)}}var w=(s,e,t)=>new Promise((i,r)=>{var l=n=>{try{a(t.next(n))}catch(o){r(o)}},c=n=>{try{a(t.throw(n))}catch(o){r(o)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,c);a((t=t.apply(s,e)).next())});const b={title:"TestButton",run:s=>w(void 0,null,function*(){const e=new p({scene:s,text:"Hello"});return()=>{e.destroy()}})},G={title:"TestButton 2",run:s=>w(void 0,null,function*(){const e=new p({scene:s,text:"Hello2"});return()=>{e.destroy()}})};var R=(s,e,t)=>new Promise((i,r)=>{var l=n=>{try{a(t.next(n))}catch(o){r(o)}},c=n=>{try{a(t.throw(n))}catch(o){r(o)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,c);a((t=t.apply(s,e)).next())});const j=s=>R(void 0,[s],function*({scene:e,textureName:t,frameHeight:i,frameWidth:r}){return new Promise(l=>{e.load.spritesheet(t,"./assets/atlases/minesweeper01.png",{frameWidth:r,frameHeight:i}),e.load.once(Phaser.Loader.Events.COMPLETE,()=>{l()}),e.load.start()})});var I=(s,e,t)=>new Promise((i,r)=>{var l=n=>{try{a(t.next(n))}catch(o){r(o)}},c=n=>{try{a(t.throw(n))}catch(o){r(o)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,c);a((t=t.apply(s,e)).next())});const h="minesweeper",T=s=>I(void 0,null,function*(){return j({scene:s,textureName:h,frameWidth:128,frameHeight:128})}),d={cell:{textureName:h,frameIndex:0},revealedCell:{textureName:h,frameIndex:1},flag:{textureName:h,frameIndex:2},mine:{textureName:h,frameIndex:3}};class N extends Phaser.GameObjects.Container{constructor({scene:e,cellSize:t,columns:i,rows:r,minesAmount:l,onCellReveal:c,onGameOver:a}){super(e),this.isGameOver=!1,this.cellSize=t,this.columns=i,this.rows=r,this.minesAmount=l,this.flagsLeft=l,this.onCellReveal=c,this.onGameOver=a,this.grid=[],this.createGrid(),this.placeMines(),this.calculateAdjacentMines(),e.add.existing(this)}createGrid(){for(let e=0;e<this.rows;e++){this.grid[e]=[];for(let t=0;t<this.columns;t++){const i=new k({scene:this.scene,x:t*this.cellSize,y:e*this.cellSize,size:this.cellSize,row:e,col:t,onClick:this.handleCellClick.bind(this),onRightClick:this.handleCellRightClick.bind(this)});this.grid[e][t]=i,this.add(i)}}}placeMines(){let e=0;for(;e<this.minesAmount;){const t=Phaser.Math.Between(0,this.rows-1),i=Phaser.Math.Between(0,this.columns-1),r=this.grid[t][i];r.isMine||(r.isMine=!0,e++)}}calculateAdjacentMines(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++){const i=this.grid[e][t];if(!i.isMine){let r=0;this.getNeighbors(i).forEach(l=>{l.isMine&&r++}),i.adjacentMines=r}}}getNeighbors(e){const t=[];for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++){const l=e.row+i,c=e.col+r;l>=0&&l<this.rows&&c>=0&&c<this.columns&&!(r===0&&i===0)&&t.push(this.grid[l][c])}return t}handleCellClick(e){this.isGameOver||e.isRevealed||e.isFlagged||(e.reveal(),e.isMine?this.gameOver(!1):e.adjacentMines===0&&this.revealAdjacentCells(e),this.onCellReveal&&this.onCellReveal(e),this.checkWinCondition()&&this.gameOver(!0))}handleCellRightClick(e){this.isGameOver||e.isRevealed||(e.toggleFlag(),this.flagsLeft+=e.isFlagged?-1:1,this.onCellReveal&&this.onCellReveal(e))}revealAdjacentCells(e){this.getNeighbors(e).forEach(t=>{!t.isRevealed&&!t.isFlagged&&(t.reveal(),t.adjacentMines===0&&this.revealAdjacentCells(t))})}checkWinCondition(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++){const i=this.grid[e][t];if(!i.isMine&&!i.isRevealed)return!1}return!0}gameOver(e){this.isGameOver=!0,e||this.grid.forEach(t=>{t.forEach(i=>{i.isMine&&i.reveal()})}),this.onGameOver&&this.onGameOver(e)}}class k extends Phaser.GameObjects.Container{constructor({scene:e,x:t,y:i,size:r,row:l,col:c,onClick:a,onRightClick:n}){super(e,t,i),this.isMine=!1,this.isRevealed=!1,this.isFlagged=!1,this.adjacentMines=0,this.row=l,this.col=c,this.onClick=a,this.onRightClick=n,this.bg=e.add.image(0,0,d.cell.textureName,d.cell.frameIndex).setDisplaySize(r,r).setInteractive().on("pointerdown",o=>{o.rightButtonDown()?this.onRightClick(this):this.onClick(this)}),this.text=e.add.text(0,0,"",{fontSize:`${r*.6}px`,color:"#000"}),this.text.setOrigin(.5),this.add([this.bg,this.text]),this.setSize(r,r),this.setPosition(t+r/2,i+r/2)}reveal(){this.isRevealed||(this.isRevealed=!0,this.bg.setTexture(d.revealedCell.textureName,d.revealedCell.frameIndex),this.isMine?this.bg.setTexture(d.mine.textureName,d.mine.frameIndex):this.adjacentMines>0&&this.text.setText(this.adjacentMines.toString()))}toggleFlag(){this.isFlagged=!this.isFlagged,this.bg.setTexture(this.isFlagged?d.flag.textureName:d.cell.textureName,this.isFlagged?d.flag.frameIndex:d.cell.frameIndex)}}var A=(s,e,t)=>new Promise((i,r)=>{var l=n=>{try{a(t.next(n))}catch(o){r(o)}},c=n=>{try{a(t.throw(n))}catch(o){r(o)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,c);a((t=t.apply(s,e)).next())});const B={title:"Minesweeper",run:s=>A(void 0,null,function*(){yield T(s);const e=new N({scene:s,cellSize:32,columns:10,rows:10,minesAmount:15,onCellReveal:t=>{console.log("onCellReveal",t)},onGameOver:t=>{console.log("onGameOver",t)}});return s.add.existing(e),()=>{e.destroy()}})},F=Array.from(new Set([g("Phaser Games"),B,g("Simple Games"),b,G]));class m extends Phaser.Scene{constructor(){super(m.name)}preload(){this.load.image("sky","./assets/images/space3.png"),this.load.image("logo","./assets/images/phaser3-logo.png"),this.load.image("red","./assets/images/red.png")}create(){this.add.image(400,300,"sky");const e=this.add.particles(0,0,"red",{speed:100,scale:{start:1,end:0},blendMode:"ADD"}),t=this.physics.add.image(400,100,"logo");t.setVelocity(100,200),t.setBounce(1,1),t.setCollideWorldBounds(!0),e.startFollow(t),console.log("Game started")}}const D={mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,parent:"game",width:960,height:640},y={width:800,height:600,physics:{default:"arcade",arcade:{gravity:{x:0,y:200}}},type:Phaser.AUTO,backgroundColor:"#4488aa",transparent:!0,scale:D,scene:[m]};var H=Object.defineProperty,L=Object.defineProperties,z=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,x=(s,e,t)=>e in s?H(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,P=(s,e)=>{for(var t in e||(e={}))W.call(e,t)&&x(s,t,e[t]);if(C)for(var t of C(e))$.call(e,t)&&x(s,t,e[t]);return s},S=(s,e)=>L(s,z(e)),V=(s,e,t)=>new Promise((i,r)=>{var l=n=>{try{a(t.next(n))}catch(o){r(o)}},c=n=>{try{a(t.throw(n))}catch(o){r(o)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,c);a((t=t.apply(s,e)).next())});const U=S(P({},y),{scale:S(P({},y.scale),{mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.NONE}),scene:[new u(u.name)]}),O=new Phaser.Game(U),f=document.getElementById("stories");if(f==null)throw"no sidebar";const q=document.getElementById("gameTitle");let v;const M=(s,e)=>V(void 0,null,function*(){v==null||v(),q.innerHTML=s.title;const t=e.scene.getScene(u.name);v=yield s.run(t)});let _=0;F.forEach(s=>{s.run!=null?(J(s,f,_==0),_++):s.template==="titleDelimiter"&&K(s,f)});function J(s,e,t){const i=E({storyTag:"button",innerHtml:`${s.title}`,className:"story",parent:e});i.addEventListener("click",()=>M(s,O).catch(console.warn)),t&&setTimeout(()=>{i.focus(),M(s,O).catch(console.warn)},500)}function K(s,e){return E({storyTag:"div",innerHtml:`${s.title}`,className:"storyDelimiter",parent:e})}function E({storyTag:s,className:e,innerHtml:t,parent:i}){const r=document.createElement(s);return r.innerHTML=t,r.classList.add(e),i.append(r),r}})();})();

//# sourceMappingURL=bundle.75270de99e491167b9b2.js.map